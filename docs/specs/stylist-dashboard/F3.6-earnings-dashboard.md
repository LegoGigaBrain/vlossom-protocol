# F3.6: Earnings Dashboard

**Status**: Pending
**Priority**: Medium (Week 6)

## Purpose

Provide stylists with visibility into their earnings, including totals, trends, and payout history.

## User Story

As a stylist, I want to see how much I've earned and track my income over time, so I can manage my finances effectively.

## Components

### Page
- `app/dashboard/earnings/page.tsx` — Earnings overview page

### Components
- `components/dashboard/earnings-summary.tsx` — Total, this month, pending cards
- `components/dashboard/earnings-chart.tsx` — Weekly/monthly earnings trend
- `components/dashboard/payout-history.tsx` — List of completed payouts

## UI Layout

```
┌─────────────────────────────────────────────────────────────┐
│  Earnings                                                   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌───────────────────┐ ┌───────────────────┐ ┌─────────────┐│
│  │   Total Earnings  │ │   This Month      │ │  Pending    ││
│  │                   │ │                   │ │             ││
│  │   R85,200.00      │ │   R12,450.00      │ │ R2,340.00   ││
│  │                   │ │   ↑ 15% vs last   │ │ 3 bookings  ││
│  └───────────────────┘ └───────────────────┘ └─────────────┘│
│                                                             │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  Earnings Trend                    [Week ▼] [Month] [Year]  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  R4,000 │                        ╭──╮                       │
│         │                   ╭────╯  ╰──╮                    │
│  R3,000 │              ╭────╯          ╰──╮                 │
│         │         ╭────╯                  │                 │
│  R2,000 │    ╭────╯                       │                 │
│         │────╯                            │                 │
│  R1,000 │                                 ╰────             │
│         │                                                   │
│      R0 └───────────────────────────────────────────────────│
│           Mon   Tue   Wed   Thu   Fri   Sat   Sun           │
│                                                             │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  Payout History                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ Dec 14, 2025                                            ││
│  │ Box Braids - Jane Doe                                   ││
│  │                                           + R765.00     ││
│  └─────────────────────────────────────────────────────────┘│
│  ┌─────────────────────────────────────────────────────────┐│
│  │ Dec 13, 2025                                            ││
│  │ Silk Press - Sarah M.                                   ││
│  │                                           + R405.00     ││
│  └─────────────────────────────────────────────────────────┘│
│  ┌─────────────────────────────────────────────────────────┐│
│  │ Dec 12, 2025                                            ││
│  │ Haircut - Mike S.                                       ││
│  │                                           + R270.00     ││
│  └─────────────────────────────────────────────────────────┘│
│                                                             │
│  [Load More]                                                │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## Backend Endpoints

### Get Earnings Summary
```
GET /api/stylists/earnings
Authorization: Bearer <token>

Response: 200 OK
{
  "totalEarnings": 8520000,       // cents
  "thisMonthEarnings": 1245000,   // cents
  "lastMonthEarnings": 1082000,   // cents (for % change)
  "pendingEarnings": 234000,      // cents
  "pendingBookingsCount": 3,
  "completedBookingsCount": 47
}
```

### Get Earnings Trend
```
GET /api/stylists/earnings/trend?period=week
Authorization: Bearer <token>

Query params:
- period: "week" | "month" | "year"

Response: 200 OK
{
  "period": "week",
  "data": [
    { "date": "2025-12-08", "earnings": 76500 },
    { "date": "2025-12-09", "earnings": 120000 },
    { "date": "2025-12-10", "earnings": 85000 },
    { "date": "2025-12-11", "earnings": 0 },
    { "date": "2025-12-12", "earnings": 135000 },
    { "date": "2025-12-13", "earnings": 0 },
    { "date": "2025-12-14", "earnings": 90000 }
  ]
}
```

### Get Payout History
```
GET /api/stylists/earnings/history?page=1&limit=10
Authorization: Bearer <token>

Response: 200 OK
{
  "payouts": [
    {
      "id": "booking-uuid",
      "date": "2025-12-14T10:30:00Z",
      "serviceName": "Box Braids",
      "customerName": "Jane Doe",
      "amount": 76500,           // cents (stylist payout after platform fee)
      "status": "SETTLED"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 47,
    "hasMore": true
  }
}
```

## Earnings Calculations

### Total Earnings
```sql
SELECT SUM(stylistPayoutCents)
FROM Booking
WHERE stylistId = ? AND status = 'SETTLED'
```

### This Month Earnings
```sql
SELECT SUM(stylistPayoutCents)
FROM Booking
WHERE stylistId = ?
  AND status = 'SETTLED'
  AND completedAt >= DATE_TRUNC('month', NOW())
```

### Pending Earnings
```sql
SELECT SUM(stylistPayoutCents), COUNT(*)
FROM Booking
WHERE stylistId = ?
  AND status IN ('CONFIRMED', 'IN_PROGRESS', 'AWAITING_CUSTOMER_CONFIRMATION')
```

### Trend Data
```sql
SELECT DATE(completedAt) as date, SUM(stylistPayoutCents) as earnings
FROM Booking
WHERE stylistId = ?
  AND status = 'SETTLED'
  AND completedAt >= ?  -- start of period
GROUP BY DATE(completedAt)
ORDER BY date
```

## Chart Library

**Recommendation**: Recharts (lightweight, React-native)

```typescript
import { LineChart, Line, XAxis, YAxis, Tooltip, ResponsiveContainer } from 'recharts';

<ResponsiveContainer width="100%" height={200}>
  <LineChart data={data}>
    <XAxis dataKey="date" />
    <YAxis />
    <Tooltip formatter={(value) => formatPrice(value)} />
    <Line type="monotone" dataKey="earnings" stroke="#311E6B" />
  </LineChart>
</ResponsiveContainer>
```

## Period Filters

| Period | Data Points | X-Axis Labels |
|--------|-------------|---------------|
| Week | 7 days | Mon, Tue, Wed... |
| Month | ~30 days | 1, 5, 10, 15... |
| Year | 12 months | Jan, Feb, Mar... |

## Currency Formatting

All amounts stored in cents, displayed in ZAR:
```typescript
formatPrice(8520000)  // → "R85,200.00"
formatPrice(76500)    // → "R765.00"
```

## Empty States

### No Earnings Yet
```
┌─────────────────────────────────────────────────┐
│                                                 │
│           No earnings yet                       │
│                                                 │
│   Complete your first booking to start          │
│   earning on Vlossom.                           │
│                                                 │
│   [View Pending Requests]                       │
│                                                 │
└─────────────────────────────────────────────────┘
```

### No Data for Period
```
No earnings for this week
```

## Acceptance Criteria

- [ ] Summary cards show correct totals
- [ ] This month shows % change vs last month
- [ ] Pending shows count of active bookings
- [ ] Chart displays earnings trend
- [ ] Period toggle (week/month/year) works
- [ ] Payout history loads with pagination
- [ ] "Load More" fetches additional entries
- [ ] All amounts formatted as ZAR currency
- [ ] Empty states shown when no data
- [ ] Loading states during fetch
- [ ] Chart responsive on mobile
