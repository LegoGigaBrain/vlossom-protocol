# F3.2: Booking Requests Queue

**Status**: Pending
**Priority**: High (Week 5)

## Purpose

Queue for stylists to review, approve, or decline incoming booking requests from customers.

## User Story

As a stylist, I want to see all pending booking requests and approve or decline them, so I can manage my schedule effectively.

## Components

### Page
- `app/dashboard/requests/page.tsx` â€” Full requests list with filters

### Components
- `components/dashboard/request-card.tsx` â€” Request card with customer info
- `components/dashboard/request-details-dialog.tsx` â€” Full booking details modal
- `components/dashboard/approve-dialog.tsx` â€” Confirmation before approving
- `components/dashboard/decline-dialog.tsx` â€” Decline with reason required

## UI Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Booking Requests                           [Filter â–¼]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ â—‹ Jane Doe                                              â”‚â”‚
â”‚  â”‚   Box Braids - 4h                                       â”‚â”‚
â”‚  â”‚   ğŸ“… Tomorrow, Dec 15 at 10:00 AM                       â”‚â”‚
â”‚  â”‚   ğŸ“ Your Location (Sandton)                            â”‚â”‚
â”‚  â”‚   ğŸ’° R850.00                                            â”‚â”‚
â”‚  â”‚                                                          â”‚â”‚
â”‚  â”‚   [View Details]    [Decline]    [âœ“ Approve]            â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ â—‹ Mike Smith                                            â”‚â”‚
â”‚  â”‚   Haircut & Beard Trim - 1h 30m                         â”‚â”‚
â”‚  â”‚   ğŸ“… Dec 16 at 2:00 PM                                  â”‚â”‚
â”‚  â”‚   ğŸ“ Customer Location (Rosebank)                       â”‚â”‚
â”‚  â”‚   ğŸ’° R450.00 + R50.00 travel                            â”‚â”‚
â”‚  â”‚                                                          â”‚â”‚
â”‚  â”‚   [View Details]    [Decline]    [âœ“ Approve]            â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ No more pending requests â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Request Details Dialog

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Booking Request Details                    âœ•   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  Customer                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ â—‹ Jane Doe                                  â”‚â”‚
â”‚  â”‚   Member since Dec 2024                     â”‚â”‚
â”‚  â”‚   5 completed bookings                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                 â”‚
â”‚  Service                                        â”‚
â”‚  Box Braids                                     â”‚
â”‚  Duration: 4 hours                              â”‚
â”‚                                                 â”‚
â”‚  Date & Time                                    â”‚
â”‚  Tomorrow, Dec 15, 2025                         â”‚
â”‚  10:00 AM - 2:00 PM                             â”‚
â”‚                                                 â”‚
â”‚  Location                                       â”‚
â”‚  Your Base Location                             â”‚
â”‚  123 Main St, Sandton                           â”‚
â”‚                                                 â”‚
â”‚  Price Breakdown                                â”‚
â”‚  Service: R850.00                               â”‚
â”‚  Platform Fee: R85.00                           â”‚
â”‚  Your Payout: R765.00                           â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Decline   â”‚  â”‚      âœ“ Approve          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Backend Integration

### Existing Endpoints Used
```
POST /api/bookings/:id/approve
Body: { stylistId: string, notes?: string }
Response: Updated booking with status PENDING_CUSTOMER_PAYMENT

POST /api/bookings/:id/decline
Body: { stylistId: string, reason: string }
Response: Updated booking with status DECLINED
```

### New Query Endpoint
```
GET /api/stylists/bookings?status=PENDING_STYLIST_APPROVAL
```

Returns bookings where:
- `stylistId` matches authenticated user
- `status` = `PENDING_STYLIST_APPROVAL`
- Sorted by `createdAt` ASC (oldest first)

## State Transitions

```
PENDING_STYLIST_APPROVAL
   â”‚
   â”œâ”€â”€ approve() â†’ PENDING_CUSTOMER_PAYMENT
   â”‚                 (Customer now needs to pay)
   â”‚
   â””â”€â”€ decline() â†’ DECLINED
                   (Booking cancelled, customer notified)
```

## Decline Reasons (Predefined)

- Schedule conflict
- Service not available
- Location too far
- Need more information
- Other (with text input)

## Acceptance Criteria

- [ ] List shows all pending requests
- [ ] Each card shows customer name, service, date/time, location, price
- [ ] "View Details" opens full details dialog
- [ ] Approve button confirms and transitions to PENDING_PAYMENT
- [ ] Decline requires reason selection
- [ ] Success toast shown after action
- [ ] List updates after approve/decline
- [ ] Empty state when no pending requests
- [ ] Loading skeleton while fetching

## Edge Cases

- Request expires after 24h (auto-declined) â€” show "Expired" badge
- Customer cancels before approval â€” remove from list
- Multiple requests for same time slot â€” show conflict warning
