# F2.5: Location Selection

## Feature Specification

**Feature ID:** F2.5
**Feature Name:** Location Selection
**Milestone:** 2 - Customer Can Book
**Priority:** Medium
**Status:** Planned
**Depends On:** F2.4

---

## User Story

> As a customer, I want to choose where my appointment will take place so that the service happens at a convenient location.

---

## Acceptance Criteria

1. Display location options based on stylist's operating mode
2. For FIXED: Only stylist's base location available
3. For MOBILE: Only customer home available
4. For HYBRID: Both options available
5. Customer home option requires address input
6. Travel fee displayed for mobile services (future)
7. "Continue" navigates to booking summary (F2.6)

---

## Technical Specification

### Location Types

```typescript
type LocationType = "STYLIST_BASE" | "CUSTOMER_HOME";

interface LocationSelection {
  type: LocationType;
  address: string;
  lat: number | null;
  lng: number | null;
}
```

### Operating Mode Logic

```typescript
function getAvailableLocationTypes(operatingMode: string): LocationType[] {
  switch (operatingMode) {
    case "FIXED":
      return ["STYLIST_BASE"];
    case "MOBILE":
      return ["CUSTOMER_HOME"];
    case "HYBRID":
      return ["STYLIST_BASE", "CUSTOMER_HOME"];
    default:
      return ["STYLIST_BASE"];
  }
}
```

---

### Files to Create

| File | Purpose |
|------|---------|
| `apps/web/components/booking/location-selector.tsx` | Location selection step |

---

### Component: LocationSelector

```tsx
interface LocationSelectorProps {
  stylist: {
    operatingMode: string;
    baseLocation: { address: string; lat: number; lng: number } | null;
    serviceRadius: number | null;
  };
  selectedLocation: LocationSelection | null;
  onLocationSelect: (location: LocationSelection) => void;
  onContinue: () => void;
  onBack: () => void;
}
```

**Layout - HYBRID Mode:**
```
+----------------------------------+
| [<] Back                         |
| Choose Location                  |
+----------------------------------+
|                                  |
| â—‹ Stylist's Location             |
|   123 Main St, Cape Town         |
|                                  |
+----------------------------------+
|                                  |
| â— Your Location                  |
|   [Enter your address      ]     |
|                                  |
+----------------------------------+
|                                  |
| Note: Travel fee may apply       |
|                                  |
| [       Continue       ]         |
+----------------------------------+
```

**Layout - FIXED Mode:**
```
+----------------------------------+
| [<] Back                         |
| Appointment Location             |
+----------------------------------+
|                                  |
| ðŸ“ Stylist's Location            |
|   123 Main St, Cape Town         |
|                                  |
|   This stylist works at a        |
|   fixed location.                |
|                                  |
+----------------------------------+
| [       Continue       ]         |
+----------------------------------+
```

**Layout - MOBILE Mode:**
```
+----------------------------------+
| [<] Back                         |
| Your Location                    |
+----------------------------------+
|                                  |
| ðŸ“ Enter your address            |
|   [                        ]     |
|                                  |
|   This stylist travels to you.   |
|   Service radius: 25km           |
|                                  |
+----------------------------------+
| [       Continue       ]         |
+----------------------------------+
```

---

### Address Input

For MVP, simple text input:

```tsx
<Input
  placeholder="Enter your full address"
  value={address}
  onChange={(e) => setAddress(e.target.value)}
/>
```

**Future Enhancement:**
- Google Places Autocomplete
- Map pin selection
- Geocoding for lat/lng

---

## UI/UX Requirements

### Visual Design
- Radio button selection (for HYBRID)
- Address card with map icon
- Text input for customer address
- Subtle info text about operating mode

### States
- **FIXED:** Single option, auto-selected, Continue enabled
- **MOBILE:** Address required, Continue disabled until entered
- **HYBRID:** Must select option, address required for customer home

### Validation
- Address minimum length: 10 characters
- No special validation for MVP (future: geocoding validation)

---

## Travel Fee Logic (Future)

```typescript
// Not implemented in MVP - placeholder for future
interface TravelFee {
  distanceKm: number;
  feeAmountCents: number;
}

function calculateTravelFee(
  stylistLocation: { lat: number; lng: number },
  customerLocation: { lat: number; lng: number },
  feePerKm: number
): TravelFee {
  // Haversine distance calculation
  // Return fee based on distance
}
```

---

## Tasks Breakdown

| Task | Effort | Priority |
|------|--------|----------|
| Create `LocationSelector` component | 45min | P0 |
| Implement operating mode logic | 20min | P0 |
| Create FIXED mode layout | 15min | P0 |
| Create MOBILE mode layout | 20min | P0 |
| Create HYBRID mode layout | 20min | P0 |
| Address input with validation | 20min | P1 |
| Connect to booking flow | 15min | P0 |
| Add info text for each mode | 15min | P1 |

**Total Estimated Time:** ~3 hours

---

## Verification Checklist

- [ ] FIXED mode shows stylist location only
- [ ] MOBILE mode shows address input only
- [ ] HYBRID mode shows both options
- [ ] Radio selection works (HYBRID)
- [ ] Address input accepts text
- [ ] Address validation works (min length)
- [ ] Continue disabled without valid selection
- [ ] Continue navigates to summary
- [ ] Back navigates to datetime
- [ ] Stylist location displays correctly
- [ ] Service radius displayed for MOBILE
- [ ] Mobile responsive layout
