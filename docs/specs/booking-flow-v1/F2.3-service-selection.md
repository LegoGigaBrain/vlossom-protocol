# F2.3: Service Selection

## Feature Specification

**Feature ID:** F2.3
**Feature Name:** Service Selection
**Milestone:** 2 - Customer Can Book
**Priority:** High
**Status:** Planned
**Depends On:** F2.2

---

## User Story

> As a customer, I want to select a specific service from a stylist's offerings so that I can proceed with booking an appointment.

---

## Acceptance Criteria

1. Display all active services from selected stylist
2. Show service name, description, price, and duration
3. Allow single service selection
4. Display running total with selected service
5. "Continue" button enabled only when service selected
6. Navigate to date/time picker (F2.4) on continue

---

## Technical Specification

### Data Source

Services come from the stylist profile (already fetched in F2.2):
```typescript
interface Service {
  id: string;
  name: string;
  category: string;
  description: string | null;
  priceAmountCents: string;
  estimatedDurationMin: number;
}
```

---

### Files to Create/Modify

| File | Purpose |
|------|---------|
| `apps/web/components/booking/service-selector.tsx` | Service selection step |
| `apps/web/components/booking/booking-dialog.tsx` | Multi-step dialog container |

---

### Component: ServiceSelector

```tsx
interface ServiceSelectorProps {
  services: Service[];
  selectedServiceId: string | null;
  onSelect: (serviceId: string) => void;
  onContinue: () => void;
}
```

**Layout:**
```
+----------------------------------+
| Select a Service                 |
+----------------------------------+
| ○ Box Braids            R350     |
|   Hair styling                   |
|   Duration: 2h 30min             |
+----------------------------------+
| ● Cornrows              R200     |  <- Selected
|   Hair styling                   |
|   Duration: 1h 30min             |
+----------------------------------+
| ○ Loc Maintenance       R180     |
|   Hair care                      |
|   Duration: 1h                   |
+----------------------------------+
|                                  |
| Total: R200                      |
|                                  |
| [       Continue       ]         |
+----------------------------------+
```

---

### Component: BookingDialog

Multi-step dialog following wallet dialog pattern:

```tsx
type BookingStep =
  | "service"      // F2.3: Select service
  | "datetime"     // F2.4: Pick date/time
  | "location"     // F2.5: Choose location
  | "summary"      // F2.6: Review booking
  | "payment"      // F2.7: Pay via escrow
  | "processing"   // Processing payment
  | "success";     // Booking confirmed

interface BookingDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  stylist: Stylist;
  initialServiceId?: string; // Pre-select if coming from service card
}

interface BookingState {
  serviceId: string | null;
  scheduledTime: Date | null;
  locationType: "STYLIST_BASE" | "CUSTOMER_HOME";
  locationAddress: string;
  locationLat: number | null;
  locationLng: number | null;
  notes: string;
}
```

**Step Navigation:**
```tsx
const [step, setStep] = useState<BookingStep>("service");

const handleServiceSelect = (serviceId: string) => {
  setState(prev => ({ ...prev, serviceId }));
};

const handleContinueToDateTime = () => {
  if (state.serviceId) setStep("datetime");
};
```

---

### Price Formatting

```tsx
// lib/utils.ts
export function formatPrice(cents: string | number): string {
  const amount = typeof cents === "string" ? parseInt(cents, 10) : cents;
  return `R${(amount / 100).toFixed(2)}`;
}

export function formatDuration(minutes: number): string {
  const hours = Math.floor(minutes / 60);
  const mins = minutes % 60;
  if (hours === 0) return `${mins}min`;
  if (mins === 0) return `${hours}h`;
  return `${hours}h ${mins}min`;
}
```

---

## UI/UX Requirements

### Visual Design
- Radio button selection (single choice)
- Selected service: Primary color border + background
- Category displayed as subtle tag
- Price right-aligned, prominent
- Duration below description, muted text

### States
- **Unselected:** Light border, no background
- **Selected:** Primary border, soft primary background
- **Hover:** Slight lift shadow
- **Continue disabled:** Muted when no selection

### Interactions
- Click anywhere on card: Selects service
- Continue button: Disabled until service selected
- Back button: Returns to profile page

---

## Tasks Breakdown

| Task | Effort | Priority |
|------|--------|----------|
| Create `BookingDialog` shell | 30min | P0 |
| Create `ServiceSelector` component | 45min | P0 |
| Add price/duration formatters | 15min | P0 |
| Implement selection state | 20min | P0 |
| Add running total display | 15min | P1 |
| Style selected/unselected states | 20min | P1 |
| Connect to booking flow | 20min | P0 |

**Total Estimated Time:** ~3 hours

---

## Verification Checklist

- [ ] All services from stylist display
- [ ] Service name displays correctly
- [ ] Service description displays (or hidden if null)
- [ ] Price formatted correctly (R350)
- [ ] Duration formatted correctly (1h 30min)
- [ ] Category tag displays
- [ ] Single selection works
- [ ] Selected state visually distinct
- [ ] Total updates when service selected
- [ ] Continue button disabled when no selection
- [ ] Continue navigates to datetime step
- [ ] Dialog can be closed
- [ ] Pre-selection works if serviceId passed
