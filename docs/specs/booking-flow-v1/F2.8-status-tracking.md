# F2.8: Booking Status Tracking

## Feature Specification

**Feature ID:** F2.8
**Feature Name:** Booking Status Tracking
**Milestone:** 2 - Customer Can Book
**Priority:** High
**Status:** Planned
**Depends On:** F2.7

---

## User Story

> As a customer, I want to view my bookings and their current status so that I can track my appointments and know what to expect.

---

## Acceptance Criteria

1. "My Bookings" page accessible from navigation
2. List all customer's bookings (upcoming and past)
3. Display booking status with visual indicators
4. Show booking details (stylist, service, date, location)
5. Allow navigation to individual booking details
6. Filter by status (Upcoming, Completed, Cancelled)
7. Empty state when no bookings exist

---

## Technical Specification

### Booking Status Flow

```
PENDING_PAYMENT â†’ CONFIRMED â†’ IN_PROGRESS â†’ COMPLETED
       â”‚                           â”‚
       â–¼                           â–¼
  CANCELLED               DISPUTED â†’ RESOLVED
```

### Status Definitions

| Status | Description | Customer Action |
|--------|-------------|-----------------|
| `PENDING_PAYMENT` | Booking created, awaiting payment | Complete payment |
| `CONFIRMED` | Payment locked in escrow | Await appointment |
| `IN_PROGRESS` | Service being performed | None |
| `COMPLETED` | Service done, payment released | Rate/review (future) |
| `CANCELLED` | Booking cancelled, refund processed | View details |
| `DISPUTED` | Issue raised, under review | Await resolution |

---

### API Endpoints

```
GET /api/bookings
```

**Query Parameters:**
- `status` - Filter by status (optional)
- `page` - Pagination (default: 1)
- `limit` - Items per page (default: 10)

**Response:**
```json
{
  "bookings": [
    {
      "id": "uuid",
      "status": "CONFIRMED",
      "stylist": {
        "id": "uuid",
        "displayName": "Sarah Johnson",
        "avatarUrl": "url"
      },
      "service": {
        "id": "uuid",
        "name": "Box Braids",
        "priceAmountCents": "35000"
      },
      "scheduledStartTime": "2025-01-15T10:00:00Z",
      "locationType": "STYLIST_BASE",
      "locationAddress": "123 Main St, Cape Town",
      "createdAt": "2025-01-10T14:30:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 25,
    "totalPages": 3
  }
}
```

```
GET /api/bookings/:id
```

**Response:** Full booking details including escrow transaction hash.

---

### Files to Create

| File | Purpose |
|------|---------|
| `apps/web/app/bookings/page.tsx` | My Bookings list page |
| `apps/web/app/bookings/[id]/page.tsx` | Booking details page |
| `apps/web/components/bookings/booking-list.tsx` | Booking list component |
| `apps/web/components/bookings/booking-card.tsx` | Individual booking card |
| `apps/web/components/bookings/booking-details.tsx` | Full booking details |
| `apps/web/components/bookings/status-badge.tsx` | Status indicator badge |
| `apps/web/hooks/use-bookings.ts` | Bookings data hook |

---

### Component: BookingList

```tsx
interface BookingListProps {
  bookings: Booking[];
  isLoading: boolean;
  onBookingClick: (bookingId: string) => void;
}
```

**Layout:**
```
+----------------------------------+
| My Bookings                      |
+----------------------------------+
| [Upcoming] [Completed] [All]     |
+----------------------------------+
| +------------------------------+ |
| | Sarah Johnson                | |
| | Box Braids                   | |
| | Mon, 15 Jan Â· 10:00 AM       | |
| | [â—] Confirmed          R350  | |
| +------------------------------+ |
|                                  |
| +------------------------------+ |
| | Mike's Barber                | |
| | Haircut                      | |
| | Thu, 18 Jan Â· 2:00 PM        | |
| | [â—] Confirmed          R150  | |
| +------------------------------+ |
+----------------------------------+
```

---

### Component: BookingCard

```tsx
interface BookingCardProps {
  booking: {
    id: string;
    status: BookingStatus;
    stylist: { displayName: string; avatarUrl: string | null };
    service: { name: string; priceAmountCents: string };
    scheduledStartTime: string;
    locationType: string;
  };
  onClick: () => void;
}
```

**Card Layout:**
```
+----------------------------------+
| [Avatar] Sarah Johnson     [>]   |
|          Box Braids              |
|                                  |
| ðŸ“… Mon, 15 Jan 2025 Â· 10:00 AM   |
| ðŸ“ 123 Main St, Cape Town        |
|                                  |
| [â— Confirmed]            R350.00 |
+----------------------------------+
```

---

### Component: StatusBadge

```tsx
interface StatusBadgeProps {
  status: BookingStatus;
  size?: "sm" | "md";
}

const STATUS_CONFIG = {
  PENDING_PAYMENT: {
    label: "Awaiting Payment",
    color: "yellow",
    icon: "clock",
  },
  CONFIRMED: {
    label: "Confirmed",
    color: "green",
    icon: "check",
  },
  IN_PROGRESS: {
    label: "In Progress",
    color: "blue",
    icon: "play",
  },
  COMPLETED: {
    label: "Completed",
    color: "gray",
    icon: "check-circle",
  },
  CANCELLED: {
    label: "Cancelled",
    color: "red",
    icon: "x",
  },
  DISPUTED: {
    label: "Under Review",
    color: "orange",
    icon: "alert",
  },
};
```

---

### Component: BookingDetails

```tsx
interface BookingDetailsProps {
  booking: FullBooking;
  onCancel: () => void;
  onContact: () => void;
}
```

**Layout:**
```
+----------------------------------+
| [<] Back                         |
| Booking Details                  |
+----------------------------------+
| [â— Confirmed]                    |
| Booking #VLS-2025-001234         |
+----------------------------------+
| Stylist                          |
| [Avatar] Sarah Johnson           |
|          âœ“ Verified              |
+----------------------------------+
| Service                          |
| Box Braids                       |
| Duration: 2h 30min               |
+----------------------------------+
| Date & Time                      |
| Monday, 15 January 2025          |
| 10:00 AM                         |
+----------------------------------+
| Location                         |
| ðŸ“ 123 Main St, Cape Town        |
|    [Open in Maps]                |
+----------------------------------+
| Payment                          |
| Service              R350.00     |
| Platform Fee          R35.00     |
| â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        |
| Total                R385.00     |
| Status: Locked in Escrow âœ“       |
+----------------------------------+
| Notes                            |
| Please use gentle products       |
+----------------------------------+
|                                  |
| [    Cancel Booking    ]         |
|                                  |
+----------------------------------+
```

---

### Hook: useBookings

```tsx
import { useQuery } from "@tanstack/react-query";
import { getBookings, getBooking } from "@/lib/booking-client";

export function useBookings(status?: BookingStatus) {
  return useQuery({
    queryKey: ["bookings", status],
    queryFn: () => getBookings({ status }),
    staleTime: 30 * 1000, // 30 seconds
  });
}

export function useBooking(id: string) {
  return useQuery({
    queryKey: ["booking", id],
    queryFn: () => getBooking(id),
    enabled: !!id,
  });
}
```

---

### Filter Tabs

```tsx
type BookingFilter = "upcoming" | "completed" | "all";

const FILTER_CONFIG = {
  upcoming: {
    label: "Upcoming",
    statuses: ["PENDING_PAYMENT", "CONFIRMED", "IN_PROGRESS"],
  },
  completed: {
    label: "Completed",
    statuses: ["COMPLETED"],
  },
  all: {
    label: "All",
    statuses: null, // No filter
  },
};
```

---

## UI/UX Requirements

### Visual Design
- Tab-based filtering (Upcoming/Completed/All)
- Card-based booking list
- Status badge with color coding
- Chronological ordering (nearest first for upcoming)
- Pull-to-refresh on mobile

### States
- **Loading:** Skeleton cards
- **Empty:** Friendly empty state with CTA
- **Error:** Error message with retry

### Empty States

**No Upcoming Bookings:**
```
+----------------------------------+
|         ðŸ“…                       |
|   No upcoming bookings           |
|                                  |
|   Find a stylist and book        |
|   your first appointment!        |
|                                  |
|   [  Browse Stylists  ]          |
+----------------------------------+
```

**No Completed Bookings:**
```
+----------------------------------+
|         âœ“                        |
|   No completed bookings yet      |
|                                  |
|   Your completed appointments    |
|   will appear here.              |
+----------------------------------+
```

---

### Date/Time Formatting

```typescript
function formatBookingDate(isoString: string): string {
  const date = new Date(isoString);
  return date.toLocaleDateString('en-ZA', {
    weekday: 'short',
    day: 'numeric',
    month: 'short',
    year: 'numeric'
  });
  // "Mon, 15 Jan 2025"
}

function formatBookingTime(isoString: string): string {
  const date = new Date(isoString);
  return date.toLocaleTimeString('en-ZA', {
    hour: 'numeric',
    minute: '2-digit',
    hour12: true
  });
  // "10:00 AM"
}

function isUpcoming(scheduledTime: string): boolean {
  return new Date(scheduledTime) > new Date();
}
```

---

## Tasks Breakdown

| Task | Effort | Priority |
|------|--------|----------|
| Create `useBookings` hook | 20min | P0 |
| Create `StatusBadge` component | 20min | P0 |
| Create `BookingCard` component | 30min | P0 |
| Create `BookingList` component | 25min | P0 |
| Create `/bookings` page | 30min | P0 |
| Add filter tabs | 20min | P1 |
| Create `BookingDetails` component | 45min | P0 |
| Create `/bookings/[id]` page | 25min | P0 |
| Add empty states | 20min | P1 |
| Add loading skeletons | 20min | P1 |
| Add navigation link to header | 10min | P0 |

**Total Estimated Time:** ~4.5 hours

---

## Verification Checklist

- [ ] My Bookings page loads
- [ ] Bookings list displays correctly
- [ ] Filter tabs work (Upcoming/Completed/All)
- [ ] Booking cards show all required info
- [ ] Status badges display correct colors
- [ ] Clicking card navigates to details
- [ ] Booking details page loads
- [ ] All sections display correctly
- [ ] Cancel button visible (when applicable)
- [ ] Empty state shows for no bookings
- [ ] Loading skeletons display
- [ ] Error state with retry works
- [ ] Date/time formatted correctly
- [ ] Price formatted correctly
- [ ] Navigation to Maps works
- [ ] Mobile responsive layout
